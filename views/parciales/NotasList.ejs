<!-- views/parciales/NotasList.ejs -->
<% if (cursos.length === 0) { %>
  <div class="alert alert-info text-center p-4">
    <% if (search) { %>
        No se encontraron resultados para "<strong><%= search %></strong>"
      <% } else { %>
        Escriba algo para buscar...
      <% } %>
  </div>
<% } else { %>
  <% cursos.forEach(curso => { %>
    <h2 class="mt-4">Curso: <%= curso.curso %></h2>

    <% curso.materias.forEach(materia => { %>
      <h3><%= materia.materia_nombre %></h3>
      <div class="profesor mb-2">
        Profesor: <%= materia.profesor_nombre %> <%= materia.profesor_apellido %>
      </div>

      <table class="tabla-curso-curso-<%= curso.curso.toLowerCase().replace(/\s/g, '-') %>">
        <thead>
          <tr>
            <th>Alumno</th>
            <% [1,2,3].forEach(() => { %>
              <th>Notas</th>
              <th class="promedio-trimestral">Prom.</th>
            <% }) %>
            <th>Ex. Dic</th>
            <th>Ex. Mar</th>
            <th>Promedio Final</th>
          </tr>
        </thead>
        <tbody>
          <% materia.alumnos.forEach(al => { %>
            <tr>
              <td><%= al.apellido %>, <%= al.nombre %></td>

              <% al.notas.forEach(tri => { 
                const vals = Object.values(tri.calificaciones).filter(n => n !== null);
                const prom = vals.length 
                  ? (Math.trunc((vals.reduce((a,b)=>a+b,0) / vals.length) * 100) / 100).toFixed(2)
                  : '-';
              %>
                <td class="nota">
                  <div class="nota-grid">
                    <% [1,2,3,4].forEach(i => { %>
                      <div class="nota-celda"><%= tri.calificaciones[i] ?? '-' %></div>
                    <% }) %>
                  </div>
                </td>
                <td class="promedio-trimestral"><%= prom %></td>
              <% }) %>

              <td class="examen"><%= al.examen_dic ?? '-' %></td>
              <td class="examen"><%= al.examen_mar ?? '-' %></td>
              <td class="promedio-final">
                <%= al.promedio_final !== null ? al.promedio_final.toFixed(2) : '-' %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% }) %>
  <% }) %>
<% } %>
